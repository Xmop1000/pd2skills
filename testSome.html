<!DOCTYPE html>
<html lang="zh-TW">
	<head>
		<title>Payday2 技能模擬器 (beta 0.2)</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=0">
		
		<script src="angular.min.js"></script>

		<style>
			#loaderDiv {
			   position: fixed;
			   top: 0;
			   right: 0;
			   bottom: 0;
			   left: 0;
			   z-index: 1100;
			   background-color: white;
			   opacity: .6;
			}

			.ajax-loader {
			   position: absolute;
			   left: 50%;
			   top: 50%;
			   margin-left: -32px; /* -1 * image width / 2 */
			   margin-top: -32px; /* -1 * image height / 2 */
			   display: block;
			}
		</style>
		
	</head>
	
	<body ng-app="myApp">
		<div id="loaderDiv" loader>
		    <p class="ajax-loader">載入中</p>
		</div>

		<script>
			angular.module('myApp', [])
			.factory('httpInterceptor', function ($q, $rootScope, $log) {

			    var numLoadings = 0;

			    return {
			        request: function (config) {

			            numLoadings++;

			            // Show loader
			            $rootScope.$broadcast("loader_show");
			            return config || $q.when(config)

			        },
			        response: function (response) {

			            if ((--numLoadings) === 0) {
			                // Hide loader
			                $rootScope.$broadcast("loader_hide");
			            }

			            return response || $q.when(response);

			        },
			        responseError: function (response) {

			            if (!(--numLoadings)) {
			                // Hide loader
			                $rootScope.$broadcast("loader_hide");
			            }

			            return $q.reject(response);
			        }
			    };
			})
			.config(function ($httpProvider) {
			    $httpProvider.interceptors.push('httpInterceptor');
			})
			.directive("loader", function ($rootScope) {
			    return function ($scope, element, attrs) {
			        $scope.$on("loader_show", function () {
			            return element.show();
			        });
			        return $scope.$on("loader_hide", function () {
			            return element.hide();
			        });
			    };
			})
		</script>
	</body>
</html>